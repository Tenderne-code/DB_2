# DB_2
数据库约束设计与触发器设计

使用触发器完成类似物化视图的数据一致性维护

## 练习一 约束设计
employees(eno, ename, dno, salary, level, email)
department(dno, dname, manager, budget)
努力完成如下约束设计：
标下划线的是主码，波浪线的是外码，两个表相互参照。
dname要求是{‘销售部’、’财务部’，’人事部’}之一。
每个level取值限定为1到5的整数，同时每个特定level的员工其salary有个固定的取值区间，比如level为1的salary范围在[1000, 2000]，这个请同学们自己定义一下。
email要满足电子邮件的正则表达式的规范，同学们可以自行网上搜索其定义。
一个部门所有员工的salary总和不能超过该部门的budget。

## 练习二 触发器设计
滑动窗口是流数据处理里面的基本单元，通常用于维护最近N个数据的聚合信息。可以把滑动窗口看成是一个定长队列，窗口中每新到一个数据，则会将最老的数据元素从窗口中顶出去。   
我们设计触发器来计算滑动窗口的两个聚集函数：sum和max。   
我们建立一个用来存放原始数据的originData(id, value)表，再建立两个存放最近N个数据的表，sum_slidingWin(id, value)表和max_slidingWin(id, value)表，分别用于计算滑动窗口的sum和max值。计算出来的聚集值存放在aggResult(sumRes, maxRes)中，初始时存在一行(0,0)。   
你可以构造一个模拟器，定时产生往originData表里插入数据，限定每次插入一行。id被设置为自动单调递增以代表数据元素到达窗口的顺序，value可以是限定在一定区间内的随机产生的整数。   
然后定义监视该表插入事件的触发器，触发器的任务如下：   
维护sum_slidingWin(id, value)表和max_slidingWin(id, value)表，使其保持最新的N个数据。   
以增量方式更新aggResult表中的聚集值。   
探讨维护max_slidingWin(id, value)表中存在的最少数据，比如max_slidingWin(id, value)滑动窗口中当前存在的数据依次是{3,5,7,2,5,6}，则标黑的数据都可以从中删掉，因为它们永远没有机会变成最大值（存在在它们之后到达且比它们大的数据），请使用触发器维护这样一个大纲数据，也即新到达一个数据后，就把它之前且比它小的数据都删掉。   
调整N的大小，看看性能影响，或者简单看看大纲数据大致占N的百分比。   

